<filters  xmlns="http://indexdata.com/metaproxy">
  <filter type="sparql">
    <!--defaults uri="http://bibframe.indexdata.com/sparql/"/-->
    <defaults uri="http://localhost:8890/sparql/"/>
    <db path="work" schema="sparql-results">
      <prefix>rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns</prefix>
      <prefix>bf: http://bibframe.org/vocab/</prefix>
      <form>SELECT
              ?work
              (sql:GROUP_DIGEST (?wtitle, ' ; ', 1000, 1)) AS ?title
              (sql:GROUP_DIGEST (?creatorlabel, ' ; ', 1000, 1))AS ?creator
              (sql:GROUP_DIGEST (?subjectlabel, ' ; ', 1000, 1))AS ?subject
      </form>
      <criteria>?work a bf:Work</criteria>

      <criteria> OPTIONAL {
          ?work bf:workTitle ?wt .
          ?wt bf:titleValue ?wtitle }
      </criteria>
      <criteria> OPTIONAL {
          ?work bf:creator ?creator .
          ?creator bf:label ?creatorlabel }
      </criteria>
      <criteria>OPTIONAL {
          ?work bf:subject ?subject .
          ?subject bf:label ?subjectlabel }
      </criteria>
      <index type="4">?wt bf:titleValue %v FILTER(contains(%v, %s))</index>
      <index type="1003">?creator bf:label %v FILTER(contains(%v, %s))</index>
      <index type="21">?subject bf:label %v FILTER(contains(%v, %s))</index>
      <index type="1016"> {
            ?work ?op1 ?child .
            ?child ?op2 %v FILTER(contains(STR(%v), %s))
          }
      </index>
      <modifier>GROUP BY $work</modifier>
    </db>
    <db path="works" schema="rdf">
      <prefix>rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns</prefix>
      <prefix>bf: http://bibframe.org/vocab/</prefix>
      <form>CONSTRUCT { 
          ?work bf:title ?wtitle . 
          ?work bf:instanceTitle ?title .
          ?work bf:author ?creator . 
          ?work bf:subject ?subjectlabel }
      </form>
      <criteria>?work a bf:Work</criteria>

      <criteria>?work bf:workTitle ?wt</criteria>
      <criteria>?wt bf:titleValue ?wtitle</criteria>
      <index type="4">?wt bf:titleValue %v FILTER(contains(%v, %s))</index>
      <criteria>?work bf:creator ?creator</criteria>
      <criteria>?creator bf:label ?creatorlabel</criteria>
      <index type="1003">?creator bf:label %v FILTER(contains(%v, %s))</index>
      <criteria>?work bf:subject ?subject</criteria>
      <criteria>?subject bf:label ?subjectlabel</criteria>
      <index type="21">?subject bf:label %v FILTER(contains(%v, %s))</index>
    </db>
    <db path="instance" schema="sparql-results">
      <prefix>rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns</prefix>
      <prefix>bf: http://bibframe.org/vocab/</prefix>
      <form>SELECT ?instance ?title ?format</form>
      <criteria>?instance a bf:Instance</criteria>

      <criteria>?instance bf:title ?title</criteria>
      <index type="4">?instance bf:title %v FILTER(contains(%v, %s))</index>
      <criteria>?instance bf:format ?format</criteria>
      <index type="1013">?instance bf:format %s</index>
    </db>
    <db path="place" schema="sparql-results">
      <prefix>rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns</prefix>
      <prefix>bf: http://bibframe.org/vocab/</prefix>
      <form>SELECT  ?label ?id ?place ?relatedTo ?authorizedAccessPoint </form>
      <criteria>?place a bf:Place</criteria>
      <criteria>?place bf:label ?label</criteria>
      <criteria>OPTIONAL { ?place bf:identifier ?id}</criteria>
      <criteria>OPTIONAL { ?place bf:relatedTo ?relatedTo}</criteria>
      <criteria>OPTIONAL { ?place bf:authorizedAccessPoint ?authorizedAccessPoint}</criteria>
      <index type="bf.place">?place bf:label %v FILTER(contains(%v, %s))</index>
      <index type="any">?place bf:label %v FILTER(contains(%v, %s))</index>
    </db>
    <db path="person" schema="sparql-results">
      <prefix>rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns</prefix>
      <prefix>bf: http://bibframe.org/vocab/</prefix>
      <form>SELECT  ?label ?id ?person ?relatedTo ?authorizedAccessPoint </form>
      <criteria>?person a bf:Person</criteria>
      <criteria>?person bf:label ?label</criteria>
      <criteria>OPTIONAL { ?person bf:identifier ?id}</criteria>
      <criteria>OPTIONAL { ?person bf:relatedTo ?relatedTo}</criteria>
      <criteria>OPTIONAL { ?person bf:authorizedAccessPoint ?authorizedAccessPoint}</criteria>
      <index type="bf.person">?person bf:label %v FILTER(contains(%v, %s))</index>
      <index type="any">?person bf:label %v FILTER(contains(%v, %s))</index>
    </db>
    <db path="meeting" schema="sparql-results">
      <prefix>rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns</prefix>
      <prefix>bf: http://bibframe.org/vocab/</prefix>
      <form>SELECT  ?label ?id ?meeting ?relatedTo ?authorizedAccessPoint </form>
      <criteria>?meeting a bf:Meeting</criteria>
      <criteria>?meeting bf:label ?label</criteria>
      <criteria>OPTIONAL { ?meeting bf:identifier ?id}</criteria>
      <criteria>OPTIONAL { ?meeting bf:relatedTo ?relatedTo}</criteria>
      <criteria>OPTIONAL { ?meeting bf:authorizedAccessPoint ?authorizedAccessPoint}</criteria>
      <index type="bf.meeting">?meeting bf:label %v FILTER(contains(%v, %s))</index>
      <index type="any">?meeting bf:label %v FILTER(contains(%v, %s))</index>
    </db>
    <db path="agent" schema="sparql-results">
      <prefix>rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns</prefix>
      <prefix>bf: http://bibframe.org/vocab/</prefix>
      <form>SELECT  ?label ?id ?agent ?relatedTo ?authorizedAccessPoint </form>
      <criteria>?agent a bf:Agent</criteria>
      <criteria>?agent bf:label ?label</criteria>
      <criteria>OPTIONAL { ?agent bf:identifier ?id}</criteria>
      <criteria>OPTIONAL { ?agent bf:relatedTo ?relatedTo}</criteria>
      <criteria>OPTIONAL { ?agent bf:authorizedAccessPoint ?authorizedAccessPoint}</criteria>
      <index type="bf.agent">?agent bf:label %v FILTER(contains(%v, %s))</index>
      <index type="any">?agent bf:label %v FILTER(contains(%v, %s))</index>
    </db>
    <db path="event" schema="sparql-results">
      <prefix>rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns</prefix>
      <prefix>bf: http://bibframe.org/vocab/</prefix>
      <form>SELECT  ?label ?id ?event ?relatedTo ?authorizedAccessPoint </form>
      <criteria>?event a bf:Event</criteria>
      <criteria>?event bf:label ?label</criteria>
      <criteria>OPTIONAL { ?event bf:identifier ?id}</criteria>
      <criteria>OPTIONAL { ?event bf:relatedTo ?relatedTo}</criteria>
      <criteria>OPTIONAL { ?event bf:authorizedAccessPoint ?authorizedAccessPoint}</criteria>
      <index type="bf.event">?event bf:label %v FILTER(contains(%v, %s))</index>
      <index type="any">?event bf:label %v FILTER(contains(%v, %s))</index>
    </db>
    <db path="organization" schema="sparql-results">
      <prefix>rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns</prefix>
      <prefix>bf: http://bibframe.org/vocab/</prefix>
      <form>SELECT  ?label ?id ?organization ?relatedTo ?authorizedAccessPoint </form>
      <criteria>?organization a bf:Organization</criteria>
      <criteria>?organization bf:label ?label</criteria>
      <criteria>OPTIONAL { ?organization bf:identifier ?id}</criteria>
      <criteria>OPTIONAL { ?organization bf:relatedTo ?relatedTo}</criteria>
      <criteria>OPTIONAL { ?organization bf:authorizedAccessPoint ?authorizedAccessPoint}</criteria>
      <index type="bf.organization">?organization bf:label %v FILTER(contains(%v, %s))</index>
      <index type="any">?organization bf:label %v FILTER(contains(%v, %s))</index>
    </db>
    <db path="topic" schema="sparql-results">
      <prefix>rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns</prefix>
      <prefix>bf: http://bibframe.org/vocab/</prefix>
      <form>SELECT  ?label ?id ?topic ?relatedTo ?authorizedAccessPoint </form>
      <criteria>?topic a bf:Topic</criteria>
      <criteria>?topic bf:label ?label</criteria>
      <criteria>OPTIONAL { ?topic bf:identifier ?id}</criteria>
      <criteria>OPTIONAL { ?topic bf:relatedTo ?relatedTo}</criteria>
      <criteria>OPTIONAL { ?topic bf:authorizedAccessPoint ?authorizedAccessPoint}</criteria>
      <index type="bf.topic">?topic bf:label %v FILTER(contains(%v, %s))</index>
      <index type="any">?topic bf:label %v FILTER(contains(%v, %s))</index>
    </db>
    <db path="title" schema="sparql-results">
        <prefix>rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns</prefix>
        <prefix>bf: http://bibframe.org/vocab/</prefix>
        <form>SELECT ?title ?titleValue 
            ?formDesignation ?partNumber ?partTitle ?subtitle 
            ?titleAttribute ?titleQualifier ?titleSource 
            ?titleType ?titleVariationDate</form>
        <criteria>?title a bf:Title</criteria>
        <criteria>OPTIONAL { ?title bf:titleValue ?titleValue}</criteria>
        <criteria>OPTIONAL { ?title bf:formDesignation ?formDesignation}</criteria>
        <criteria>OPTIONAL { ?title bf:partNumber ?partNumber}</criteria>
        <criteria>OPTIONAL { ?title bf:partTitle ?partTitle}</criteria>
        <criteria>OPTIONAL { ?title bf:subtitle ?subtitle}</criteria>
        <criteria>OPTIONAL { ?title bf:titleAttribute ?titleAttribute}</criteria>
        <criteria>OPTIONAL { ?title bf:titleQualifier ?titleQualifier}</criteria>
        <criteria>OPTIONAL { ?title bf:titleSource ?titleSource}</criteria>
        <criteria>OPTIONAL { ?title bf:titleType ?titleType}</criteria>
        <criteria>OPTIONAL { ?title bf:titleVariationDate ?titleVariationDate}</criteria>
        <index type="bf.title">?title bf:titleValue %v FILTER(contains(%v, %s))</index>
        <index type="bf.subtitle">?title bf:subtitle %v FILTER(contains(%v, %s))</index>
        <index type="bf.parttitle">?title bf:partTitle %v FILTER(contains(%v, %s))</index>
        <index type="any">?title ?rel  %v FILTER(contains(str(%v), %s))</index>
    </db>
    <db path="node" schema="rdf">
      <prefix>rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns</prefix>
      <prefix>bf: http://bibframe.org/vocab/</prefix>
      <form>DESCRIBE ?node </form>
      <index type="any">?node ?rel ?obj FILTER( str(?node) = %s )</index>
    </db>
  </filter>
  <filter type="log">
    <message>http</message>
    <category apdu="true"/>
  </filter>
  <filter type="http_client">
    <x-forwarded-for>true</x-forwarded-for>
  </filter>
</filters>
